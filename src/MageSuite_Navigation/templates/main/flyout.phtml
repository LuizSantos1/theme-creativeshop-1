<?php
// @codingStandardsIgnoreFile
/** @var \Magento\Framework\View\Element\Template $block */

$item = $block->getItem();
$parentId = $block->getParentItemId();
$isAllCategories = $item->getIdentifier() === 'all-categories';
$level = $block->getLevel();
?>
<div
    class="cs-navigation__flyout"
    data-category-identifier="<?= $item->getCategoryIdentifier() ?>"
    data-parent-item-id="<?= $parentId; ?>"
>
<?php
if ($item->hasSubItems()) {
    echo $this->getLayout()
        ->createBlock(Magento\Framework\View\Element\Template::class)
        ->setTemplate("MageSuite_Navigation::main/list.phtml")
        ->setItem($item)
        ->setShowCategoryIconSubcats($block->getShowCategoryIconSubcats())
        ->setShowProductsAmountSubcats($block->getShowProductsAmountSubcats())
        ->setLevel($level)
        ->setIsAllCategories($isAllCategories)
        ->setParentItemId($item->getId())
        ->toHtml();

    if ($isAllCategories) {
        foreach($item->getSubItems() as $subItem) {
            if ($subItem->hasSubItems()) {
                echo $this->getLayout()
                    ->createBlock(Magento\Framework\View\Element\Template::class)
                    ->setTemplate("MageSuite_Navigation::main/list.phtml")
                    ->setItem($subItem)
                    ->setShowCategoryIconSubcats($subItem)
                    ->setShowProductsAmountSubcats($subItem)
                    ->setLevel($level)
                    ->setIsMegaDropdownSublist(true)
                    ->setParentItemId($subItem->getId())
                    ->toHtml();
            }
        }
    }
}

/*if($item->hasFeaturedProducts()) {
    echo $this->getLayout()
        ->createBlock(Magento\Framework\View\Element\Template::class)
        ->setTemplate("MageSuite_Navigation::main/featured-products.phtml")
        ->setItem($item)
        ->toHtml();
}*/

if($item->hasImageTeaser()) {
    echo $this->getLayout()
        ->createBlock(Magento\Framework\View\Element\Template::class)
        ->setTemplate("MageSuite_Navigation::main/image-teaser.phtml")
        ->setItem($item)
        ->setButtonIcon($block->getImageTeaserButtonIcon())
        ->setAdditionalCssClasses('cs-navigation__teaser')
        ->toHtml();
}
?>
</div>
